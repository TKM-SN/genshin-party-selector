<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>パーティセレクター</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif; margin: 16px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    button { padding:8px 10px; border-radius:10px; border:1px solid rgba(0,0,0,.15); background:#fff; cursor:pointer; }
    button.primary { background:#16a34a; color:#fff; border-color:#16a34a; }
    button.warn { background:#f59e0b; color:#111; border-color:#f59e0b; }

    input[type="text"] { padding:8px 10px; border-radius:10px; border:1px solid rgba(0,0,0,.2); min-width: 280px; }
    select { padding:8px 10px; border-radius:10px; border:1px solid rgba(0,0,0,.2); background:#fff; }

    .muted { opacity: .75; }

    /* 共通カード */
    .card{
      display:flex; align-items:center; gap:10px;
      padding:6px 8px; border-radius:12px;
      border:1px solid rgba(0,0,0,0.08);
      margin:6px 0;
      background:#fff;
    }

    .face{
      width:52px; height:52px; border-radius:12px;
      user-select:none; cursor:pointer;
      transition: filter .15s ease, transform .05s ease;
      display:block;
    }
    .face:active{ transform: scale(.98); }

    .unowned{ filter: grayscale(100%) brightness(55%) contrast(90%); }
    .owned{ filter: brightness(110%) contrast(110%); }

    .badge{
      display:inline-block; padding:2px 8px; border-radius:999px;
      border:1px solid rgba(0,0,0,0.12);
      font-size:12px; opacity:.9;
    }
    .small{ font-size:12px; opacity:.85; }

    /* 全選択ボタンだけ色 */
    #selectAll {
      background: #a855f7;
      border-color: #a855f7;
      color: #fff;
    }

    /* =========================
       一覧を “横並びタイル” にする（強制）
       ========================= */
    #list{
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(84px, 1fr)) !important;
      gap: 10px !important;
      max-width: 1200px;
    }
    #list .card{
      margin: 0 !important;
      padding: 10px 6px !important;

      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 6px !important;

      text-align: center;
      cursor: pointer;
      position: relative; /* バッジ用 */
    }
    #list .face{
      width: 72px !important;
      height: 72px !important;
      border-radius: 14px !important;
    }
    /* 一覧は文字を隠す（検索はJS側なのでOK） */
    #list .card > div{
      display: none !important;
    }

    /* 角バッジ（★4/★5/旅人属性） */
    .corner-badge{
      position:absolute;
      top:6px;
      right:6px;
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.92);
      pointer-events:none;
    }
    .corner-badge.left{
      left:6px;
      right:auto;
    }

    /* =========================
       抽選結果も横並び（グリッド）
       ========================= */
    #resultCards{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      max-width: 1100px;
    }
    /* 抽選結果のカードは横レイアウトのまま */
    #resultCards .card{
      margin: 0;
      position: relative; /* バッジ用 */
    }

    /* =========================
       画面最下部中央：権利者向けお知らせ（閉じる×付き）
       ========================= */
    #rightsNotice{
      position: fixed;
      left: 50%;
      bottom: 10px;
      transform: translateX(-50%);
      z-index: 9999;

      max-width: min(92vw, 860px);
      padding: 10px 44px 10px 14px; /* 右側に×のスペース */
      border-radius: 12px;

      background: rgba(255,255,255,.96);
      border: 1px solid rgba(0,0,0,.18);
      box-shadow: 0 6px 18px rgba(0,0,0,.12);

      font-size: 12px;
      line-height: 1.6;
      text-align: center;
    }
    #rightsNotice .close{
      position: absolute;
      top: 6px;
      right: 8px;
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.9);
      cursor: pointer;
      font-size: 16px;
      line-height: 1;
      display: grid;
      place-items: center;
    }
    #rightsNotice .close:active{
      transform: scale(.98);
    }
    #rightsNotice .mini{
      opacity: .85;
    }
  </style>
</head>
<body>
  <h1>パーティセレクター</h1>

  <div class="row">
    <button id="clearCache" class="warn">キャッシュ削除</button>
    <button id="selectAll" class="warn">全選択</button>
    <button id="reset">選択の全解除</button>
  </div>

  <div style="margin:10px 0;" class="muted" id="status">読み込み中…</div>

  <div class="row">
    <label>検索:
      <input id="q" type="text" placeholder="例：雷電 / アルベド / raiden / albedo" />
    </label>

    <label>表示数:
      <input id="maxShow" type="range" min="1" max="300" step="1" value="60" />
      <span id="maxShowLabel">60</span>
    </label>
  </div>

  <div id="list"></div>
  <hr />

  <div class="row">
    <label>抽選元:
      <select id="mode">
        <option>所持のみ</option>
        <option>未所持のみ</option>
        <option>混ぜる（所持人数を指定）</option>
      </select>
    </label>

    <label id="ownedKWrap">所持から:
      <select id="ownedK">
        <option>0</option><option>1</option><option selected>2</option><option>3</option><option>4</option>
      </select>
    </label>

    <label>レア度:
      <select id="rarityFilter">
        <option value="all" selected>全部</option>
        <option value="5">★5のみ</option>
        <option value="4">★4のみ</option>
      </select>
    </label>

    <label><input id="kleeBoost" type="checkbox" /> クレー出やすいモード</label>
    <button id="draw" class="primary">4人抽選！</button>
  </div>

  <div id="result"></div>

  <!-- ここはあなたの既存JS -->
  <script src="./app.js"></script>

  <!-- 画面最下部中央の警告（×で閉じられる） -->
  <div id="rightsNotice" role="status" aria-live="polite">
    <div><b>このサイトは非公式のファンメイドWebツールです。</b></div>
    <div class="mini">原神 © COGNOSPHERE.</div>
    <div class="mini">お問い合わせフォームは現在準備中です。</div>
    <div class="mini">権利者様からお問い合わせフォームへ連絡があった場合速やかに対応します。</div>
    <button class="close" type="button" aria-label="閉じる">×</button>
  </div>

  <script>
    // 「×で閉じたら次回から表示しない」ために localStorage を使う
    (function(){
      const KEY = "rights_notice_dismissed_v1";
      const notice = document.getElementById("rightsNotice");
      if (!notice) return;

      // 既に閉じていたら非表示
      try {
        if (localStorage.getItem(KEY) === "1") {
          notice.style.display = "none";
          return;
        }
      } catch (_) {}

      // 閉じる処理
      const btn = notice.querySelector(".close");
      btn?.addEventListener("click", () => {
        notice.style.display = "none";
        try { localStorage.setItem(KEY, "1"); } catch (_) {}
      });
    })();
  </script>
</body>
</html>
